# {{ switch_type | upper }} Switch Template - Golden Configuration
# Pulled from: {{ golden_config._meta.pulled_from }}
# Pull date: {{ golden_config._meta.pulled_at }}
# Switch model: {{ golden_config._meta.switch_model }}
# Target group: {{ golden_config._meta.target_group }}
#
# This file is auto-generated by playbooks/pull_golden_config.yml
# Manual edits will be overwritten on next pull.
---

# Template variable name for this switch type
{{ switch_type }}_switch_template:
  _meta:
    source_switch: "{{ golden_config._meta.pulled_from }}"
    pulled_at: "{{ golden_config._meta.pulled_at }}"
    switch_model: "{{ golden_config._meta.switch_model }}"

  # Required VLANs for this switch type
  required_vlans:
{% for vlan_id, vlan in golden_config.vlans.items() | sort %}
    - id: "{{ vlan_id }}"
      name: "{{ vlan.name }}"
{% endfor %}

  # Port configuration (descriptions, enabled state, speed)
  ports:
{% for port_id, port in golden_config.ports.items() | sort(attribute='0') %}
    "{{ port_id }}":
      enabled: {{ port.enabled | lower }}
      name: "{{ port.name | default('') }}"
      speed: "{{ port.speed | default('auto') }}"
{% endfor %}

  # Port VLAN settings (PVID, trunking, ingress filtering)
  port_vlan_settings:
{% for port_id, settings in golden_config.port_vlan_settings.items() | sort(attribute='0') %}
    "{{ port_id }}":
      pvid: {{ settings.pvid }}
      vlan_trunking: {{ settings.vlan_trunking | lower }}
{% if settings.ingress_filtering is defined %}
      ingress_filtering: {{ settings.ingress_filtering | lower }}
{% endif %}
{% if settings.acceptable_frame_type is defined %}
      acceptable_frame_type: "{{ settings.acceptable_frame_type }}"
{% endif %}
{% endfor %}

  # VLAN membership details
  vlans:
{% for vlan_id, vlan in golden_config.vlans.items() | sort %}
    "{{ vlan_id }}":
      name: "{{ vlan.name }}"
{% if vlan.tagged_ports %}
      tagged_ports: {{ vlan.tagged_ports | to_json }}
{% endif %}
{% if vlan.untagged_ports %}
      untagged_ports: {{ vlan.untagged_ports | to_json }}
{% endif %}
{% endfor %}

  # Management settings
  management:
    vlan: "1"
    ssh: true
    https: true
    snmp: true
    syslog: true

  # Spanning tree settings (preserved from manual config)
  spanning_tree:
    mode: rstp
    priority: 32768
{% if switch_type == 'idf' %}
    edge_ports: "1-19"
{% elif switch_type == 'podium' %}
    edge_ports: "1-8"
{% endif %}

