# zyxel_security role - Security settings for Zyxel switches
# Uses HTTP API modules for configuration on GS1900/GS1915/GS1920
#
# This role uses the Base + Delta config pattern for STP settings
#
# NOTE: Spanning Tree configuration via HTTP API is not fully implemented
# in the network.zyxel collection. STP settings should be configured
# via the web interface or will use the reference switch's existing settings.
#
# Connection: Requires 'httpapi' connection (set in playbook or group_vars)
---

# ============================================================
# Load switch config based on group membership
# Uses the new *_switch_config computed variables
# ============================================================
- name: Set switch config (IDF switches)
  ansible.builtin.set_fact:
    switch_config: "{{ idf_switch_config | default({}) }}"
  when:
    - "'idf_switches' in group_names"
    - idf_switch_config is defined

- name: Set switch config (Core switches)
  ansible.builtin.set_fact:
    switch_config: "{{ core_switch_config | default({}) }}"
  when:
    - "'core_switches' in group_names"
    - core_switch_config is defined

- name: Set switch config (Podium switches)
  ansible.builtin.set_fact:
    switch_config: "{{ podium_switch_config | default({}) }}"
  when:
    - "'podium_switches' in group_names"
    - podium_switch_config is defined

# ============================================================
# Security Module Configuration (when available)
# ============================================================
# The zyxel_security module can configure various security features
- name: Configure security settings via HTTP API
  network.zyxel.zyxel_security:
    state: present
  when: false  # Disabled until module is fully implemented
  tags: [zyxel, security]

# ============================================================
# Display Summary
# ============================================================
- name: Display security configuration summary
  ansible.builtin.debug:
    msg: |
      ═══════════════════════════════════════════════════════════
      Security configuration for {{ inventory_hostname }}
      ═══════════════════════════════════════════════════════════
      Switch Type: {{ 'IDF' if 'idf_switches' in group_names else 'Core' if 'core_switches' in group_names else 'Podium' if 'podium_switches' in group_names else 'Unknown' }}
      Config Source: Base + Delta inheritance model

      NOTE: Spanning Tree HTTP API configuration is not yet implemented
      in the network.zyxel collection.

      Current STP settings on the switch are preserved.
      To modify STP settings, use the switch web interface:
        https://{{ ansible_host }}/

      Expected STP settings from config:
      - Mode: {{ switch_config.spanning_tree.mode | default('rstp') }}
      - Priority: {{ switch_config.spanning_tree.priority | default('default') }}
  when: switch_config is defined
  tags: [zyxel, security, summary]

